# Migration Plan: local file IO to Azure Storage Mount

## Summary
Migrate local file I/O usages in this repository (Technology X: `local file IO`) to use an Azure Storage Mount (Technology Y: `Azure Storage Mount`). Knowledge base: `#azure_storage_mount_knowledge_base` will be used as reference for path transformation rules and examples.

Project discovered:
- Solution contains one project: `Stockie\Stockie.csproj`
- Framework: .NET Framework4.8 (inferred from build artifacts in `obj` folder)

Identified local file I/O usages (candidates for migration):
- `Stockie\Data\DatabaseHelper.cs`
 - Contains connection strings that use `AttachDbFilename=|DataDirectory|\StockieUsers.mdf` and `AttachDbFilename=|DataDirectory|\StockieInventory.mdf`.
 - These are local MDF files referenced by LocalDB and represent local file paths that should be re-pointed to the Azure mount path.

No other obvious literal local file paths or `File.*`/`Path.*` usages were found in the project files.

## Migration Scope (per template)
- Keep the project framework (NET Framework4.8).
- Make code changes only necessary for compilation.
- Replace local file path usages with mounted-path-aware code using environment variable `AZURE_MOUNT_PATH` (default `/mnt/azure`) and `Path.Combine` as described in the knowledge base.
- Update configuration or code that constructs file paths (see DatabaseHelper change below).
- Do NOT change business logic beyond path substitutions.

## Files to modify
1. `Stockie\Data\DatabaseHelper.cs`
 - Change the static string connection fields to construct the AttachDbFilename value at runtime using `Environment.GetEnvironmentVariable("AZURE_MOUNT_PATH") ?? "/mnt/azure"` and `Path.Combine`.
 - Add `using System.IO;` if not already present.
 - Example transformation (conceptual):
 - From:
 - `private static string usersConnectionString = @"Data Source=(LocalDB)\\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\\StockieUsers.mdf;Integrated Security=True";`
 - To (conceptual):
 - `private static string GetUsersConnectionString() { var mount = Environment.GetEnvironmentVariable("AZURE_MOUNT_PATH") ?? "/mnt/azure"; var dbPath = Path.Combine(mount, "StockieUsers.mdf"); return $"Data Source=(LocalDB)\\MSSQLLocalDB;AttachDbFilename={dbPath};Integrated Security=True"; }`
 - Ensure any code that referenced the old static string uses the new method/field.

No additional packages are required for this change. The Azure Storage Mount is an OS-level mount and is accessed via normal file APIs; the migration relies on `System.IO` and `Environment` only.

## Dependency and CVE notes
- No NuGet packages will be added by default for Azure Storage Mount path support.
- After code changes, if any new packages are added (none planned), run the CVE check step described in the template.

## Version control and branch strategy
- Before making code changes:
 - Check git status.
 - If there are uncommitted changes, stash them (including untracked files) except the `.appmod/` folder.
 - Obtain current timestamp in format `yyyyMMddHHmmss` and use it to create branch:
 - `appmod/dotnet-migration-local-file-io-to-azure-storage-mount-[CurrentTimestamp]`
 - Create the branch and start performing tasks there.
- Commit after each task (concise messages). Do NOT commit files under `.appmod/`.

## Steps (high level)
1. Read knowledge base `#azure_storage_mount_knowledge_base` and capture examples/transform rules. (knowledge base will be used throughout.)
2. Create migration tracking files (already being created): `.appmod/.migration/plan.md`, `.appmod/.migration/progress.md`.
3. Prepare version control: stash uncommitted changes, create migration branch.
4. Implement code changes in `Stockie\Data\DatabaseHelper.cs`:
 - Replace hard-coded AttachDbFilename usage with runtime-built path via `AZURE_MOUNT_PATH` env var.
 - Add `using System.IO;` if missing.
 - Ensure compilation.
5. Build and fix any compilation errors only related to the migration changes.
6. Run CVE check for added packages (if any).
7. Mark tasks completed in `progress.md`, commit after each task.
8. After all tasks, run full solution build and ensure successful compilation.

## Rollout / Verification
- Compilation verification: build the solution using the appropriate build command for .NET Framework projects (Visual Studio build). Fix compile errors until build succeeds.
- No runtime deployment or changes to business logic will be done in this session.

## Notes / Constraints
- The LocalDB `AttachDbFilename` semantics are unchanged in code; only the file location will be pointed to the mounted path. Runtime concerns about LocalDB access to mounted files (permissions, service access, path semantics) are outside the scope — scope is code-level changes for successful compilation only.

----

Generated by automated migration plan generator. Replace `[CurrentTimestamp]` when creating the migration branch as instructed in the migration template.
